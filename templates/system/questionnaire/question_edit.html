<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>编辑问题</title>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <!-- Vue.js 3 -->
    <script src="{{ url_for('static', filename='index/js/vue.global.js') }}"></script>
    <!-- Naive UI -->
    <script src="{{ url_for('static', filename='index/js/naiveui.js') }}"></script>
    <!-- 引入外部CSS文件 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='system/questionnaire/css/question_edit.css') }}" />
  </head>

  <body>
    <div id="app">
      <n-message-provider>
        <div class="question-editor">
          <div class="editor-header">
            <n-icon size="20" style="margin-right: 8px; vertical-align: middle">
              <svg viewBox="0 0 24 24">
                <path
                  fill="currentColor"
                  d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
                />
              </svg>
            </n-icon>
            编辑问题
          </div>

          <div class="editor-content">
            <n-form
              ref="formRef"
              :model="formData"
              :rules="rules"
              label-placement="left"
              label-width="100px"
            >
              <!-- 问题标题 -->
              <div class="form-item">
                <n-form-item label="问题标题" path="title">
                  <n-input
                    v-model:value="formData.title"
                    placeholder="请输入问题标题"
                  />
                </n-form-item>
              </div>

              <!-- 问题描述 -->
              <div class="form-item">
                <n-form-item label="问题描述" path="description">
                  <n-input
                    v-model:value="formData.description"
                    type="textarea"
                    placeholder="请输入问题描述"
                    :rows="3"
                  />
                </n-form-item>
              </div>

              <!-- 问题类型 -->
              <div class="form-item">
                <n-form-item label="问题类型" path="questionType">
                  <n-select
                    v-model:value="formData.questionType"
                    placeholder="请选择问题类型"
                    :options="questionTypeOptions"
                    @update:value="handleQuestionTypeChange"
                  />
                </n-form-item>
              </div>

              <!-- 是否必填 -->
              <div class="form-item">
                <n-form-item label="是否必填">
                  <n-switch v-model:value="formData.isRequired">
                    <template #checked>是</template>
                    <template #unchecked>否</template>
                  </n-switch>
                </n-form-item>
              </div>

              <!-- 排序 -->
              <div class="form-item">
                <n-form-item label="排序">
                  <n-input-number
                    v-model:value="formData.sortOrder"
                    placeholder="排序号"
                    :min="0"
                  />
                </n-form-item>
              </div>

              <!-- 选项设置 -->
              <div v-if="showOptions" class="form-item">
                <n-form-item label="选项设置">
                  <div style="width: 100%">
                    <div style="margin-bottom: 16px">
                      <n-button type="primary" @click="addOption" size="small">
                        <template #icon>
                          <n-icon>
                            <svg viewBox="0 0 24 24">
                              <path
                                fill="currentColor"
                                d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"
                              />
                            </svg>
                          </n-icon>
                        </template>
                        添加选项
                      </n-button>
                      <n-text
                        depth="3"
                        style="margin-left: 12px; font-size: 12px"
                      >
                        勾选"正确"可设置该选项为正确答案
                      </n-text>
                    </div>

                    <div
                      v-for="(option, index) in formData.options"
                      :key="option.id"
                      class="option-item"
                    >
                      <div class="option-label">选项[[ index + 1 ]]</div>
                      <div style="flex: 1">
                        <n-input
                          v-model:value="option.text"
                          placeholder="选项文本"
                          size="small"
                        />
                      </div>
                      <div style="width: 120px">
                        <n-input
                          v-model:value="option.value"
                          placeholder="选项值"
                          size="small"
                        />
                      </div>
                      <div class="option-controls">
                        <n-checkbox
                          v-model:checked="option.isCorrect"
                          size="small"
                        >
                          正确
                        </n-checkbox>
                        <n-checkbox
                          v-model:checked="option.allowInput"
                          size="small"
                        >
                          允许输入
                        </n-checkbox>
                        <n-button
                          type="error"
                          size="small"
                          @click="removeOption(index)"
                          :disabled="formData.options.length <= 1"
                        >
                          <template #icon>
                            <n-icon>
                              <svg viewBox="0 0 24 24">
                                <path
                                  fill="currentColor"
                                  d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"
                                />
                              </svg>
                            </n-icon>
                          </template>
                        </n-button>
                      </div>
                    </div>
                  </div>
                </n-form-item>
              </div>
            </n-form>

            <div class="actions">
              <n-button @click="handleCancel">取消</n-button>
              <n-button type="primary" @click="handleSave" :loading="saving">
                保存
              </n-button>
            </div>
          </div>
        </div>
      </n-message-provider>
    </div>

    <!-- 引入外部JavaScript文件 -->
    <script src="{{ url_for('static', filename='system/questionnaire/js/question_edit.js') }}"></script>
  </body>
</html>
